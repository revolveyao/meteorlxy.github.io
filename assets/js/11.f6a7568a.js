(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{209:function(e,t,s){"use strict";s.r(t);var a=s(0),r=Object(a.a)({},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"content"},[s("p",[e._v("阅读学习Koa Core源码，基于koa v2.5.2。")]),e._v(" "),e._m(0),e._v(" "),e._m(1),e._v(" "),e._m(2),e._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/koajs/koa/tree/2.5.2",target:"_blank",rel:"noopener noreferrer"}},[e._v("koajs/koa"),s("OutboundLink")],1)]),e._v(" "),e._m(3),e._v(" "),e._m(4),e._v(" "),s("p",[e._v("这两部分代码行数比较多，就不把所有代码贴出来了。")]),e._v(" "),s("p"),e._m(5),s("p"),e._v(" "),e._m(6),e._v(" "),e._m(7),e._v(" "),e._m(8),e._v(" "),e._m(9),e._v(" "),e._m(10),e._v(" "),e._m(11),e._v(" "),e._m(12),e._v(" "),e._m(13),e._v(" "),s("p",[e._v("URL相关的一系列方法，用于解析、获取URL中的相关信息。")]),e._v(" "),e._m(14),e._v(" "),e._m(15),e._v(" "),s("ul",[e._m(16),e._v(" "),s("li",[s("code",[e._v("URL()")]),e._v("是通过"),s("a",{attrs:{href:"https://nodejs.org/api/url.html#url_class_url",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("url.URL")]),s("OutboundLink")],1),e._v("类，将"),s("code",[e._v("protocol()")]),e._v(", "),s("code",[e._v("host()")]),e._v(", "),s("code",[e._v("req.url")]),e._v("拼接在一起得到的"),s("code",[e._v("URL")]),e._v("对象")])]),e._v(" "),e._m(17),e._v(" "),s("p",[e._v("通过请求中的各个headers，获取相关的内容：")]),e._v(" "),e._m(18),e._v(" "),e._m(19),e._v(" "),e._m(20),e._v(" "),e._m(21),e._v(" "),e._m(22),e._v(" "),e._m(23),e._v(" "),e._m(24),e._v(" "),e._m(25),e._v(" "),e._m(26),e._v(" "),e._m(27),e._v(" "),e._m(28),e._v(" "),e._m(29),e._v(" "),e._m(30),e._m(31),e._v(" "),e._m(32),e._v(" "),e._m(33),e._v(" "),e._m(34),e._v(" "),e._m(35),e._v(" "),e._m(36),e._v(" "),e._m(37),e._v(" "),e._m(38),e._v(" "),e._m(39),e._v(" "),e._m(40),e._v(" "),e._m(41),e._v(" "),e._m(42),e._v(" "),s("p",[e._v("Koa对request和response的别名，以及在context上的代理，其实并不直观，不太符合语义上的直觉。")]),e._v(" "),s("p",[e._v("很早就有一个Issue("),s("a",{attrs:{href:"https://github.com/koajs/koa/issues/849",target:"_blank",rel:"noopener noreferrer"}},[e._v("Request / response aliases are bad idea #849"),s("OutboundLink")],1),e._v(")提出过这个问题，里面的讨论有些还是挺有意思的。")]),e._v(" "),s("p",[e._v("其实了解了代码的思想之后，这些就是使用习惯上的问题。")]),e._v(" "),e._m(43),e._v(" "),e._m(44),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/koajs/koa/tree/2.5.2",target:"_blank",rel:"noopener noreferrer"}},[e._v("koajs/koa v2.5.2"),s("OutboundLink")],1)])]),e._v(" "),e._m(45),e._v(" "),s("blockquote",[s("p",[e._v("Koa源码阅读："),s("br"),e._v(" "),s("router-link",{attrs:{to:"./2018-08-15-koa-core-read-source-code-part-1.html"}},[e._v("Koa Core - 源码阅读 1 - Application")]),s("br"),e._v(" "),s("router-link",{attrs:{to:"./2018-09-26-koa-core-read-source-code-part-2.html"}},[e._v("Koa Core - 源码阅读 2 - Context")])],1)])])},[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("p",[e._v("Koa的核心代码很少，就四个文件"),s("code",[e._v("application")]),e._v(", "),s("code",[e._v("context")]),e._v(", "),s("code",[e._v("request")]),e._v(", "),s("code",[e._v("response")]),e._v("，算上注释和空行目前也还没过2000行代码。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("这一篇针对"),t("code",[this._v("request")]),this._v(", "),t("code",[this._v("response")]),this._v("的源码进行阅读学习。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"koa-core"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#koa-core","aria-hidden":"true"}},[this._v("#")]),this._v(" Koa Core")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[t("code",[this._v("lib/application")])]),this._v(" "),t("li",[t("code",[this._v("lib/context")])]),this._v(" "),t("li",[t("code",[this._v("lib/request")])]),this._v(" "),t("li",[t("code",[this._v("lib/response")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("主要这四个文件，当然也还依赖了很多外部库，以及koa的其他仓库。这一篇看后两部分"),t("code",[this._v("lib/request")]),this._v(", "),t("code",[this._v("lib/response")]),this._v("。")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#request"}},[e._v("Request")]),s("ul",[s("li",[s("a",{attrs:{href:"#socket"}},[e._v("socket()")])]),s("li",[s("a",{attrs:{href:"#header-headers-get"}},[e._v("header(), headers(), get()")])]),s("li",[s("a",{attrs:{href:"#url-origin-href-path-query-querystring-search-host-hostname-url-subdomains-protocol-secure"}},[e._v("url(), origin(), href(), path(), query(), querystring(), search(), host(), hostname(), URL(), subdomains(), protocol(), secure()")])]),s("li",[s("a",{attrs:{href:"#method-idempotent-fresh-stale-charset-length-ips-ip-is-type"}},[e._v("method(), idempotent(), fresh(), stale(), charset(), length(), ips(), ip(), is(), type()")])]),s("li",[s("a",{attrs:{href:"#accept-accepts-acceptsencodings-acceptscharsets-acceptslanguages"}},[e._v("accept(), accepts(), acceptsEncodings(), acceptsCharsets(), acceptsLanguages()")])]),s("li",[s("a",{attrs:{href:"#inspect-tojson"}},[e._v("inspect(), toJSON()")])])])]),s("li",[s("a",{attrs:{href:"#response"}},[e._v("Response")]),s("ul",[s("li",[s("a",{attrs:{href:"#socket"}},[e._v("socket()")])]),s("li",[s("a",{attrs:{href:"#header-headers-get-set-append-remove"}},[e._v("header(), headers(), get(), set(), append(), remove()")])]),s("li",[s("a",{attrs:{href:"#status-message-body"}},[e._v("status(), message(), body()")])]),s("li",[s("a",{attrs:{href:"#length-vary-lastmodified-etag-type-is-attachment-redirect"}},[e._v("length(), vary(), lastModified(), etag(), type(), is(), attachment(), redirect()")])]),s("li",[s("a",{attrs:{href:"#headersent-writable-flushheaders"}},[e._v("headerSent(), writable(), flushHeaders()")])]),s("li",[s("a",{attrs:{href:"#inspect-tojson"}},[e._v("inspect(), toJSON()")])])])]),s("li",[s("a",{attrs:{href:"#more"}},[e._v("More")])]),s("li",[s("a",{attrs:{href:"#references"}},[e._v("References")])]),s("li",[s("a",{attrs:{href:"#related-posts"}},[e._v("Related posts")])])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"request"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#request","aria-hidden":"true"}},[this._v("#")]),this._v(" Request")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"socket"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#socket","aria-hidden":"true"}},[this._v("#")]),this._v(" socket()")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("获取请求对应的"),t("code",[this._v("socket")]),this._v("对象，即"),t("code",[this._v("req.socket")]),this._v("。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"header-headers-get"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#header-headers-get","aria-hidden":"true"}},[this._v("#")]),this._v(" header(), headers(), get()")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("p",[s("code",[e._v("header()")]),e._v("和"),s("code",[e._v("headers()")]),e._v("是等价的别名，针对request的headers信息，设置相应的getter和setter。只有"),s("code",[e._v("get header()")]),e._v("和"),s("code",[e._v("get headers()")]),e._v("被代理到了"),s("code",[e._v("ctx")]),e._v("上。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("code",[this._v("get()")]),this._v("是一个方法，用于获取header中的字段。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("例如："),t("code",[this._v("request.header['Content-Type']")]),this._v(" 等价于 "),t("code",[this._v("request.get('Content-Type')")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"url-origin-href-path-query-querystring-search-host-hostname-url-subdomains-protocol-secure"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#url-origin-href-path-query-querystring-search-host-hostname-url-subdomains-protocol-secure","aria-hidden":"true"}},[this._v("#")]),this._v(" url(), origin(), href(), path(), query(), querystring(), search(), host(), hostname(), URL(), subdomains(), protocol(), secure()")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("p",[e._v("用到的库包括："),s("code",[e._v("querystring")]),e._v(", "),s("code",[e._v("parseurl")]),e._v(", "),s("code",[e._v("url.format")]),e._v(", "),s("code",[e._v("url.URL")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("注意区分"),t("code",[this._v("url()")]),this._v("和"),t("code",[this._v("URL()")]),this._v(":")])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[t("code",[this._v("url()")]),this._v("直接对应的是"),t("code",[this._v("req.url")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"method-idempotent-fresh-stale-charset-length-ips-ip-is-type"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#method-idempotent-fresh-stale-charset-length-ips-ip-is-type","aria-hidden":"true"}},[this._v("#")]),this._v(" method(), idempotent(), fresh(), stale(), charset(), length(), ips(), ip(), is(), type()")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ul",[s("li",[s("code",[e._v("method()")]),e._v(": 获取请求的method。")]),e._v(" "),s("li",[s("code",[e._v("idempotent()")]),e._v(": 判断请求是否是幂等的，主要是通过请求的方法是否是"),s("code",[e._v("'GET', 'HEAD', 'PUT', 'DELETE', 'OPTIONS', 'TRACE'")]),e._v("之一来判断。")]),e._v(" "),s("li",[s("code",[e._v("fresh()")]),e._v(": 判断请求的内容是否未过期，就是判断请求的"),s("code",[e._v("Last-Modified")]),e._v("和"),s("code",[e._v("Etag")]),e._v("是否匹配，通过第三方库"),s("code",[e._v("fresh")]),e._v("实现。")]),e._v(" "),s("li",[s("code",[e._v("stale()")]),e._v(": 判断请求的内容是否已过期，即"),s("code",[e._v("!fresh")]),e._v("。")]),e._v(" "),s("li",[s("code",[e._v("charset()")]),e._v(": 获取请求的"),s("code",[e._v("Content-Type")]),e._v("中的"),s("code",[e._v("charset")]),e._v("，通过第三方库"),s("code",[e._v("content-type")]),e._v("辅助实现。")]),e._v(" "),s("li",[s("code",[e._v("length()")]),e._v(": 获取请求的"),s("code",[e._v("Content-Length")]),e._v("。")]),e._v(" "),s("li",[s("code",[e._v("ips()")]),e._v(": 如果请求经过了反向代理，获取请求的"),s("code",[e._v("X-Forwarded-For")]),e._v("中的ip数组。")]),e._v(" "),s("li",[s("code",[e._v("ip()")]),e._v(": 如果请求经过了反向代理，获取请求的"),s("code",[e._v("X-Forwarded-For")]),e._v("中的ip数组的第一个ip。如果没有经过反向代理，返回"),s("code",[e._v("socket.remoteAddress")]),e._v("。")]),e._v(" "),s("li",[s("code",[e._v("is()")]),e._v(": 判断请求的"),s("code",[e._v("Content-Type")]),e._v("是否是某种或某些类型，通过第三方库"),s("code",[e._v("type-is")]),e._v("实现。")]),e._v(" "),s("li",[s("code",[e._v("type()")]),e._v(": 获取请求的"),s("code",[e._v("Content-Type")]),e._v("。")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"accept-accepts-acceptsencodings-acceptscharsets-acceptslanguages"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#accept-accepts-acceptsencodings-acceptscharsets-acceptslanguages","aria-hidden":"true"}},[this._v("#")]),this._v(" accept(), accepts(), acceptsEncodings(), acceptsCharsets(), acceptsLanguages()")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ul",[s("li",[s("code",[e._v("accept()")]),e._v(": 解析请求的"),s("code",[e._v("Accept-*")]),e._v("一系列headers。通过第三方库"),s("code",[e._v("accepts")]),e._v("实现，返回该库的一个"),s("code",[e._v("Accept")]),e._v("对象。")]),e._v(" "),s("li",[s("code",[e._v("accepts()")]),e._v(": 即"),s("code",[e._v("accept.types")]),e._v("方法，判断请求的"),s("code",[e._v("Content-Type")]),e._v("是否匹配某种或某些类型。返回传入的最匹配的类型，如果均不匹配返回"),s("code",[e._v("false")]),e._v("。")]),e._v(" "),s("li",[s("code",[e._v("acceptsCharsets()")]),e._v(": 即"),s("code",[e._v("accept.charsets")]),e._v("方法，判断"),s("code",[e._v("Accept-Charset")]),e._v("。")]),e._v(" "),s("li",[s("code",[e._v("acceptsLanguages()")]),e._v(": 即"),s("code",[e._v("accept.languages")]),e._v("方法，判断"),s("code",[e._v("Accept-Language")]),e._v("。")]),e._v(" "),s("li",[s("code",[e._v("acceptsEncodings()")]),e._v(": 即"),s("code",[e._v("accept.languages")]),e._v("方法，判断"),s("code",[e._v("Accept-Encoding")]),e._v("。")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"inspect-tojson"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#inspect-tojson","aria-hidden":"true"}},[this._v("#")]),this._v(" inspect(), toJSON()")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Request的"),t("code",[this._v("inspect")]),this._v("方法。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"response"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#response","aria-hidden":"true"}},[this._v("#")]),this._v(" Response")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"socket-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#socket-2","aria-hidden":"true"}},[this._v("#")]),this._v(" socket()")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("获取响应对应的"),t("code",[this._v("socket")]),this._v("对象，即"),t("code",[this._v("res.socket")]),this._v("。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"header-headers-get-set-append-remove"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#header-headers-get-set-append-remove","aria-hidden":"true"}},[this._v("#")]),this._v(" header(), headers(), get(), set(), append(), remove()")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("p",[s("code",[e._v("header()")]),e._v("和"),s("code",[e._v("headers()")]),e._v("是等价的别名，针对response的headers信息，仅有getter，而没有setter。"),s("code",[e._v("get()")]),e._v("是一个方法，用于获取header中的字段。这三个与request中对应的方法相同，但注意均没有被代理到"),s("code",[e._v("ctx")]),e._v("上。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("code",[this._v("set()")]),this._v("是一个方法，用于设置响应中对应的header字段。")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("p",[s("code",[e._v("append()")]),e._v("方法，用于在相应的header字段中添加内容。和"),s("code",[e._v("set()")]),e._v("的区别在于，如果对应字段已存在，"),s("code",[e._v("set()")]),e._v("是直接替换相应内容，而"),s("code",[e._v("append()")]),e._v("是以数组形式追加相应内容。例如：")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[e._v("response"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token keyword"}},[e._v("set")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{attrs:{class:"token string"}},[e._v("'Foo'")]),s("span",{attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{attrs:{class:"token string"}},[e._v("'bar'")]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\nresponse"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token keyword"}},[e._v("set")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{attrs:{class:"token string"}},[e._v("'Foo'")]),s("span",{attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{attrs:{class:"token string"}},[e._v("'baz'")]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),s("span",{attrs:{class:"token comment"}},[e._v("// -> Foo: baz")]),e._v("\n\nresponse"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token keyword"}},[e._v("set")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{attrs:{class:"token string"}},[e._v("'Fo'")]),s("span",{attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{attrs:{class:"token string"}},[e._v("'bar'")]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\nresponse"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("append")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{attrs:{class:"token string"}},[e._v("'Fo'")]),s("span",{attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{attrs:{class:"token string"}},[e._v("'baz'")]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),s("span",{attrs:{class:"token comment"}},[e._v("// -> Fo: bar; baz")]),e._v("\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("code",[this._v("remove()")]),this._v("方法则是从header中移除相应字段。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("code",[this._v("set(), append(), remove()")]),this._v("均被代理到了"),t("code",[this._v("ctx")]),this._v("上。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"status-message-body"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#status-message-body","aria-hidden":"true"}},[this._v("#")]),this._v(" status(), message(), body()")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ul",[s("li",[s("code",[e._v("status()")]),e._v(": 获取和设置响应的HTTP状态码，并将请求的"),s("code",[e._v("message")]),e._v("和"),s("code",[e._v("body")]),e._v("设置为相应的信息。通过第三方库"),s("code",[e._v("statuses")]),e._v("来判断状态码是否合法，并获取对应状态码的状态信息。")]),e._v(" "),s("li",[s("code",[e._v("message()")]),e._v(": 获取和设置响应的HTTP状态码信息。如果使用的HTTP版本低于2.0，将会根据"),s("code",[e._v("status()")]),e._v("自动设置（HTTP2.0中不再包含状态信息，只包含状态码）。")]),e._v(" "),s("li",[s("code",[e._v("body()")]),e._v(": 获取和设置响应的主体，并根据传入的类型自动设置"),s("code",[e._v("Content-Type")]),e._v(", "),s("code",[e._v("Content-Length")]),e._v("等相关headers，以及设置状态码为"),s("code",[e._v("200 OK")]),e._v("或"),s("code",[e._v("204 No Content")]),e._v("。")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("注意这三个方法会彼此调用，一般只设置"),t("code",[this._v("status()")]),this._v("或只设置"),t("code",[this._v("body()")]),this._v("即可。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"length-vary-lastmodified-etag-type-is-attachment-redirect"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#length-vary-lastmodified-etag-type-is-attachment-redirect","aria-hidden":"true"}},[this._v("#")]),this._v(" length(), vary(), lastModified(), etag(), type(), is(), attachment(), redirect()")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ul",[s("li",[s("code",[e._v("length()")]),e._v(": 用于获取和设置响应的"),s("code",[e._v("Content-Length")]),e._v("，若没有手动设置过，则自动计算"),s("code",[e._v("body")]),e._v("的长度。")]),e._v(" "),s("li",[s("code",[e._v("vary()")]),e._v(": 用于设置响应的"),s("code",[e._v("Vary")]),e._v("，通过第三方库"),s("code",[e._v("vary")]),e._v("实现。")]),e._v(" "),s("li",[s("code",[e._v("lastModified()")]),e._v(": 用于获取和设置响应的"),s("code",[e._v("Last-Modified")]),e._v("。")]),e._v(" "),s("li",[s("code",[e._v("eTag()")]),e._v(": 用于获取和设置响应的"),s("code",[e._v("ETag")]),e._v("。")]),e._v(" "),s("li",[s("code",[e._v("type()")]),e._v(": 用于获取和设置响应的"),s("code",[e._v("Content-Type")]),e._v("，通过第三方库"),s("code",[e._v("cache-content-type")]),e._v("来辅助实现。")]),e._v(" "),s("li",[s("code",[e._v("is()")]),e._v(": 用于判断响应的"),s("code",[e._v("Content-Type")]),e._v("是否属于某些类型，通过第三方库"),s("code",[e._v("type-is")]),e._v("来辅助实现。")]),e._v(" "),s("li",[s("code",[e._v("attachment()")]),e._v(": 用于设置响应的"),s("code",[e._v("Content-Disposition")]),e._v("为"),s("code",[e._v("attachment")]),e._v("，同时可以传入"),s("code",[e._v("filename")]),e._v("。如果传入"),s("code",[e._v("filename")]),e._v("，则会通过"),s("code",[e._v("path.extname")]),e._v("判断扩展名，自动设置相应的"),s("code",[e._v("Content-Type")]),e._v("。通过第三方库"),s("code",[e._v("content-disposition")]),e._v("来辅助实现。")]),e._v(" "),s("li",[s("code",[e._v("redirect()")]),e._v(": 用于设置响应的"),s("code",[e._v("Location")]),e._v("，同时将"),s("code",[e._v("status")]),e._v("设置为302（除非手动设置为301）。如果请求的"),s("code",[e._v("Referrer")]),e._v("存在，可以通过传入"),s("code",[e._v("'back'")]),e._v("跳转回之前页面。同时根据请求的"),s("code",[e._v("Accepts")]),e._v("预设了返回的"),s("code",[e._v("body")]),e._v("内容和相应的"),s("code",[e._v("Content-Type")]),e._v(".")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"headersent-writable-flushheaders"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#headersent-writable-flushheaders","aria-hidden":"true"}},[this._v("#")]),this._v(" headerSent(), writable(), flushHeaders()")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ul",[s("li",[s("code",[e._v("headerSent()")]),e._v(": 判断响应的headers的内容是否已经写入"),s("code",[e._v("socket")]),e._v("，如果已经写入了，上述所有修改headers的方法都将失效，直接return。")]),e._v(" "),s("li",[s("code",[e._v("writable()")]),e._v(": 判断响应的"),s("code",[e._v("socket")]),e._v("是否可写，如果响应已结束或者socket已关闭则不可写。")]),e._v(" "),s("li",[s("code",[e._v("flushHeaders()")]),e._v(": 立即将现在已经设置好的headers发送，并开始body部分。")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"inspect-tojson-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#inspect-tojson-2","aria-hidden":"true"}},[this._v("#")]),this._v(" inspect(), toJSON()")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Response的"),t("code",[this._v("inspect")]),this._v("方法。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"more"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#more","aria-hidden":"true"}},[this._v("#")]),this._v(" More")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Koa的核心代码其实很短和好理解，还有很多就是中间件、第三方库的内容了。下一篇会将"),t("code",[this._v("koa-compose")]),this._v("过一遍，看看koa是怎么把多个中间件按顺序合成一个的。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"references"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#references","aria-hidden":"true"}},[this._v("#")]),this._v(" References")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"related-posts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#related-posts","aria-hidden":"true"}},[this._v("#")]),this._v(" Related posts")])}],!1,null,null,null);t.default=r.exports}}]);